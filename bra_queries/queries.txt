#Skapa cost_table
select ST_Length(geom)/speed AS link_cost, * into cost_table from model_graph

#SKapa heatmap
drop table if exists point_table
select (ST_DumpPoints(l.geom)).geom into point_table from all_results as l where did = 1
select * from point_table

#Skapa tabell mellan alla OD-par
SELECT 
    a.id as id_ori, 
    b.id as id_dest,
    ST_MakeLine(ST_Centroid(a.geom), ST_Centroid(b.geom)) as geom_line,
	ST_Centroid(a.geom) as geom_ori,
	ST_Centroid(b.geom) as geom_dest
 FROM emme_zones a, emme_zones b
 WHERE a.id < b.id;
 
 # För att plocka ut "representativa" (eller inte) rutter från klustringstabell
 WITH summary AS (
    SELECT p.id, 
           p.geom, 
           p.cluster_id, 
           ROW_NUMBER() OVER(PARTITION BY p.cluster_id) 
		AS rk
      FROM od_cluster p)
SELECT s.*
  FROM summary s
 WHERE s.rk = 1

